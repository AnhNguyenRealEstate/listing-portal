<mat-card>
    <ng-container *ngIf="(roles.roles$ | async)?.includes('customer-service')">
        <ng-container *ngTemplateOutlet="cardControls"></ng-container>
    </ng-container>
    <mat-card-content>
        <div class="pb-2 card-title">
            <div class="pb-2" *ngIf="property.name">{{property.name}}</div>
            <div class="card-subtitle" *ngIf="property.rentalPrice">${{property.rentalPrice}}/month</div>
        </div>
        <div *ngIf="property.address">{{property.address}}</div>
        <div *ngIf="property.managementStartDate && property.managementEndDate">
            Management period: {{property.managementStartDate | date }} - {{property.managementEndDate | date }}
        </div>
        <div *ngIf="property.activities?.length; else noRecentActivity">
            Most recent activity: {{property.activities![0].description}}
        </div>
        <ng-template #noRecentActivity>
            <div>No recent activity</div>
        </ng-template>
    </mat-card-content>
</mat-card>

<ng-template #cardControls>
    <button mat-icon-button class="controls-btn" [matMenuTriggerFor]="controlsMenu"
        [matTooltip]="'listing_card.edit' | translate" (click)="$event.stopPropagation()">
        <mat-icon color="accent">more_horiz</mat-icon>
    </button>

    <mat-menu #controlsMenu="matMenu">
        <button mat-menu-item class="d-block" [matMenuTriggerFor]="newActivityMenu">
            <mat-icon color="accent">add_box</mat-icon>
            <span>New activity</span>
        </button>
        <mat-menu #newActivityMenu="matMenu" [hasBackdrop]="true">
            <activity-upload (activityAdded)="addActivity($event)"></activity-upload>
        </mat-menu>

        <button mat-menu-item class="d-block" (click)="editProperty($event)">
            <mat-icon color="accent">edit</mat-icon>
            <span>Edit information</span>
        </button>
        <button mat-menu-item class="d-block" (click)="deleteProperty($event)">
            <mat-icon color="accent">delete</mat-icon>
            <span>Remove from system</span>
        </button>
    </mat-menu>
</ng-template>

<ng-template #confirmationDialog>
    <section class="container-flex justify-content-between">
        <p class="pb-2">Are you sure you want to delete this property from the system?</p>
        <div class="d-flex justify-content-end">
            <button mat-button color="accent" [mat-dialog-close]="true">
                {{ 'listing_edit.yes_msg' | translate }}
            </button>
            <button mat-button [mat-dialog-close]="false">{{ 'listing_edit.no_msg' | translate }}</button>
        </div>
    </section>
</ng-template>