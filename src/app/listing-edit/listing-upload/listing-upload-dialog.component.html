<div *ngIf="isEditMode && !imageSrcs.length" class="d-flex justify-content-center" style="margin-top: 40vh">
    <mat-spinner></mat-spinner>
</div>
<section #mobileUploadView class="container pt-2 py-2 d-lg-none" *ngIf="!isEditMode || imageSrcs.length">
    <div class="row">
        <div class="col-12">
            <h1 class="h3">
                <span *ngIf="isEditMode">{{ 'listing_upload.edit_listing' | translate }}</span>
                <span *ngIf="!isEditMode">{{ 'listing_upload.upload_new' | translate }}</span>
            </h1>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.purpose' | translate }}</mat-label>
                <mat-select [(ngModel)]="listing.purpose" (selectionChange)="onPurposeSelect($event)" required>
                    <mat-option selected value='For Rent'>{{ 'listing_upload.for_rent' | translate }}</mat-option>
                    <mat-option value='For Sale'>{{ 'listing_upload.for_sale' | translate }}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.category' | translate }}</mat-label>
                <mat-select id="category" [(ngModel)]="listing.category" required>
                    <mat-option value="Apartment">{{ 'listing_upload.apartment' | translate }}</mat-option>
                    <mat-option value="Villa">{{ 'listing_upload.villa' | translate }}</mat-option>
                    <mat-option value="Townhouse">{{ 'listing_upload.townhouse' | translate }}</mat-option>
                    <mat-option value="Commercial">{{ 'listing_upload.commercial' | translate }}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.location' | translate }}</mat-label>
                <input id="locations" matInput type="text" aria-label="Location" [matAutocomplete]="locationsAuto"
                    [(ngModel)]="listing.location" required>
                <mat-autocomplete #locationsAuto="matAutocomplete">
                    <mat-option *ngFor="let location of locations" value="{{location}}">{{location}}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.property_sizes' | translate }} (m<sup>2</sup>)</mat-label>
                <input matInput type="text" [(ngModel)]="listing.propertySize" class="d-inline" id="propertySize"
                    placeholder="Size..." required>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.bedrooms' | translate }}</mat-label>
                <input matInput id="bedrooms" type="text" [(ngModel)]="listing.bedrooms" class="d-inline"
                    placeholder="# of bedrooms..." required>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.bathrooms' | translate }}</mat-label>
                <input matInput id="bathrooms" type="text" [(ngModel)]="listing.bathrooms" class="d-inline"
                    placeholder="# of bathrooms..." required>
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.view' | translate }}</mat-label>
                <input matInput type="text" [(ngModel)]="listing.view" class="d-inline" id="propertyView"
                placeholder="Sông, nội khu...">
            </mat-form-field>
        </div>
        <div class="col-6">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.contact_number' | translate }}</mat-label>
                <input matInput id="contactNumber" type="text" [(ngModel)]="listing.contactNumber" class="d-inline">
            </mat-form-field>
        </div>
        <div class="col-12">
            <div class="price-input-group">
                <mat-form-field color="accent">
                    <mat-label>{{ 'listing_upload.price' | translate }}</mat-label>
                    <input matInput type="text" [(ngModel)]="listing.price" id="price" placeholder="0" required>
                    <mat-select [(ngModel)]="listing.currency" required>
                        <mat-option selected value='USD'>US$</mat-option>
                        <mat-option value='VND'>đ</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <mat-form-field color="accent">
                <mat-label>{{ 'listing_upload.address' | translate }}</mat-label>
                <input matInput id="address" type="text" aria-label="Address" [(ngModel)]="listing.address" required>
            </mat-form-field>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label class="pt-1 pb-1">{{ 'listing_upload.description' | translate }}</label>
            <div class="mat-form-field-wrapper">
                <app-editor [listing]="listing"></app-editor>
            </div>
        </div>
    </div>
    <div class="row image-container" *ngIf="imageSrcs?.length">
        <div class="col-12" *ngFor="let imgSrc of imageSrcs">
            <img [src]="imgSrc" class="listing-image">
            <button mat-button (click)="removeImage(imgSrc)">
                <mat-icon>close</mat-icon>
            </button>
        </div>
    </div>
    <div class="row pb-2">
        <div class="col-12 d-flex justify-content-end">
            <input #imageInput multiple hidden="true" type="file" accept="image/*" onclick="this.value=null"
                (change)="handleImageInput($event)" />
            <button mat-fab color="default" [matBadge]="imageFiles.length" matBadgeColor="primary"
                (click)="imageInput.click()">
                <mat-icon>image</mat-icon>
            </button>
            <span class="ps-2 pe-2"></span>
            <button *ngIf="!isEditMode" mat-fab color="accent" (click)="publishListing()">
                <mat-spinner *ngIf="listingUploadService.inProgress() | async" [diameter]="35">
                </mat-spinner>
                <mat-icon *ngIf="!(listingUploadService.inProgress() | async)">publish</mat-icon>
            </button>
            <button *ngIf="isEditMode" mat-fab color="accent" (click)="saveEdit()">
                <mat-spinner *ngIf="listingUploadService.inProgress() | async" [diameter]="35">
                </mat-spinner>
                <mat-icon *ngIf="!(listingUploadService.inProgress() | async)">save</mat-icon>
            </button>
        </div>
    </div>
</section>